Earth Freybug Uses UNAPIMON for Unhooking Critical APIs

Reference - https://www.trendmicro.com/en_us/research/24/d/earth-freybug.html
Hash - 62ad0407a9cce34afb428dee972292d2aa23c78cbc1a44627cb2e8b945195bc2

UNAPIMON itself is straightforward: It is a DLL malware written in C++ and is neither packed nor obfuscated; it is not encrypted save for a single string. 
At the DllMain function, it first checks whether it is being loaded or unloaded. When the DLL is being loaded, it creates an event object for synchronization, and starts the hooking thread.


**********Hunting with Defender****************

Detection logic 1 

DeviceProcessEvents
| where FileName contains "schtasks.exe" and InitiatingProcessFileName contains "vmtoolsd.exe"

------------------------------------------------
------------------------------------------------

Detection Logic 2

DeviceProcessEvents
| where FileName contains "schtasks.exe" and ProcessCommandLine  contains "cc.bat"
